{
	"mode": "indexed",
	"policyRule": {
	"if": {
		"allOf": [
			{
				"field": "tags.Environment",
				"exists": "false"
			},
			{
				"field": "type",
				"notEquals": "Microsoft.Compute/virtualMachines/extensions"
			},
			{
				"field": "type",
				"notEquals": "Microsoft.DevTestLab/schedules"
			},
			{
				"field": "type",
				"notEquals": "microsoft.insights/actiongroups"
			},
			{
				"field": "type",
				"notEquals": "Microsoft.Compute/restorePointCollections"
			},
			{
				"field": "type",
				"notEquals": "Microsoft.OperationsManagement/solutions"
			},
			{
				"field": "type",
				"notEquals": "Microsoft.Network/networkWatchers"
			}				
			]
		},
	  "then": {
		"effect": "append",
		"details": [
		  {
			"field": "tags.Environment",
			"value": "[resourceGroup().tags.Environment]"
		  }
		]
	  }
		}
}